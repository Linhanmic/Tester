# Tester 快速入门指南

本指南将帮助您快速上手 Tester 语言和 VS Code 扩展。

## 目录

- [环境准备](#环境准备)
- [第一个测试脚本](#第一个测试脚本)
- [核心概念](#核心概念)
- [常用命令](#常用命令)
- [位域函数入门](#位域函数入门)
- [调试技巧](#调试技巧)
- [常见问题](#常见问题)

## 环境准备

### 软件要求

1. **Visual Studio Code** (v1.80.0+)
2. **Tester 扩展** - 在 VS Code 扩展市场搜索安装
3. **ZLGCAN 设备驱动** - 根据您的设备型号安装相应驱动

### 硬件要求

- ZLGCAN CAN/CAN-FD 设备（如 USBCAN-2E-U、USBCANFD-200U 等）
- 连接到 CAN 总线的测试对象（ECU、整车等）

## 第一个测试脚本

### 1. 创建测试文件

在 VS Code 中创建一个新文件，保存为 `test.tester`

### 2. 使用模板快速生成

输入 `ttemplate` 并按 Tab 键，会自动生成以下模板：

```tester
// 设备配置
tset
  // 参数: 设备类型, 设备索引, 通道索引, 波特率
  tcaninit 4, 0, 0, 500
tend

// 测试用例集
ttitle=我的第一个测试

  1 tstart=发送测试
    // 发送 CAN 报文
    tcans 0x100, 01 02 03 04 05 06 07 08, 0, 1

    // 延时 100ms
    tdelay 100
  tend

ttitle-end
```

### 3. 运行测试

点击测试用例上方的 **"▶ 运行测试"** 按钮，测试将自动执行。

### 4. 查看结果

- **输出面板**：查看详细的测试日志
- **状态栏**：显示测试通过/失败数量
- **侧边栏**：查看设备状态和报文监控

## 核心概念

### 配置块 (tset...tend)

定义 CAN 设备配置，必须在测试用例之前：

```tester
tset
  // 设备类型4 = USBCANFD-200U
  // 设备索引0 = 第一个设备
  // 通道索引0 = 第一个通道
  // 波特率500 = 500kbps
  tcaninit 4, 0, 0, 500

  // 多通道配置
  tcaninit 4, 0, 1, 500
tend
```

### 测试用例集 (ttitle...ttitle-end)

一组相关的测试用例：

```tester
ttitle=功能测试

  1 tstart=测试用例1
    // 测试内容
  tend

  2 tstart=测试用例2
    // 测试内容
  tend

ttitle-end
```

### 测试用例 (tstart...tend)

单个独立的测试：

```tester
1 tstart=车速显示测试
  // 发送车速信号
  tcans 0x144, 10 27 00 00 00 00 00 00, 0, 1

  // 用户确认
  tconfirm 请确认车速显示为100km/h

  // 验证反馈报文
  tcanr 0x200, 1.0-1.7, 0x64, 1000
tend
```

## 常用命令

### tcans - 发送 CAN 报文

**格式**：`tcans [通道,] ID, 数据, 间隔, 次数`

```tester
// 单次发送
tcans 0x100, 01 02 03 04 05 06 07 08, 0, 1

// 周期发送：每 100ms 发送一次，共 10 次
tcans 0x100, 01 02 03 04 05 06 07 08, 100, 10

// 指定通道 1
tcans 1, 0x100, 01 02 03 04 05 06 07 08, 0, 1
```

### tcanr - 接收验证 CAN 报文

**格式**：`tcanr [通道,] ID, 位域, 期望值, 超时`

```tester
// 验证字节 1 的值为 0x12
tcanr 0x200, 1.0-1.7, 0x12, 1000

// 打印接收到的值
tcanr 0x200, 1.0-1.7, print, 1000

// 验证多个位域
tcanr 0x200, 1.0-1.7+2.0-2.7, 0x12+0x34, 1000
```

**位域格式**：`字节.起始位-字节.结束位`
- 字节从 1 开始（1 = 第一个字节）
- 位从 0-7（0 = 最低位，7 = 最高位）

### tdelay - 延时

**格式**：`tdelay 毫秒`

```tester
tdelay 100    // 延时 100ms
tdelay 1000   // 延时 1 秒
```

### tconfirm - 用户确认

**格式**：`tconfirm 提示信息`

```tester
tconfirm 请确认车速显示为100km/h
tconfirm 请确认转向灯是否点亮
```

## 位域函数入门

位域函数让测试脚本更易读、更易维护。

### 基础示例

**传统方式**：
```tester
// 手动计算每个字节的值，难以理解
tcans 0x144, 10 27 00 00 00 00 00 00, 0, 1
```

**位域函数方式**：
```tester
// 1. 定义枚举
tenum 车速单位 0=km/h, 1=mph

// 2. 定义位域函数
tbitfield 车速 车速值="车速", 车速单位="单位":
  144, 1.0-2.7="车速"/100, 3.0-3.1="单位"

// 3. 调用函数（清晰明了）
车速 车速值=100, 车速单位=km/h
```

### 实际应用

```tester
// 定义档位枚举
tenum 档位 0=P档, 1=R档, 2=N档, 3=D档, 4=S档

// 定义档位+转速函数
tbitfield 动力状态 当前档位="档位", 发动机转速="转速":
  260, 1.0-1.2="档位", 2.0-3.7="转速"/10

// 在测试中使用
ttitle=动力系统测试
  1 tstart=D档加速
    动力状态 当前档位=D档, 发动机转速=2000
    tdelay 100
    动力状态 当前档位=D档, 发动机转速=3000
  tend
ttitle-end
```

详细说明请参考 [位域函数语法文档](../BITFIELD_SYNTAX.md)

## 调试技巧

### 1. 使用报文监控

在侧边栏的"报文监控"视图中实时查看收发的 CAN 报文：

- **TX**：发送的报文（绿色）
- **RX**：接收的报文（蓝色）
- 点击 "清空" 按钮清除历史记录

### 2. 使用 print 模式

使用 `print` 替代具体值来查看接收到的数据：

```tester
// 打印接收到的值，而不是验证
tcanr 0x200, 1.0-2.7, print, 1000
```

### 3. 脚本转换调试

将位域函数转换为原始指令，查看实际生成的报文：

1. 打开命令面板 (Ctrl+Shift+P)
2. 输入 "Tester: 转换为原始指令脚本"
3. 查看转换结果

### 4. 手动发送测试

使用侧边栏的"手动发送"视图单独测试某个 CAN 报文：

1. 输入 CAN ID
2. 输入数据（空格分隔）
3. 点击发送

### 5. 分步执行

在测试用例中适当添加 `tconfirm`，暂停执行并观察状态：

```tester
1 tstart=车速测试
  车速 车速值=0, 车速单位=km/h
  tconfirm 请确认车速为0

  车速 车速值=60, 车速单位=km/h
  tconfirm 请确认车速为60

  车速 车速值=120, 车速单位=km/h
  tconfirm 请确认车速为120
tend
```

## 常见问题

### Q1: 设备打开失败

**原因**：
- 设备未连接
- 驱动未安装
- 设备被其他程序占用

**解决**：
1. 检查设备连接
2. 重新安装 ZLGCAN 驱动
3. 关闭其他使用 CAN 设备的程序
4. 在侧边栏查看设备状态

### Q2: 报文发送失败

**原因**：
- 设备未打开
- CAN 总线错误
- 波特率不匹配

**解决**：
1. 确保设备已正确打开
2. 检查 CAN 总线连接
3. 确认波特率配置正确（与总线其他节点一致）

### Q3: 接收验证超时

**原因**：
- 目标设备未响应
- 报文 ID 或位域配置错误
- 超时时间太短

**解决**：
1. 使用 `print` 模式查看实际接收到的数据
2. 检查报文 ID 是否正确
3. 检查位域配置是否正确
4. 增加超时时间

### Q4: 位域函数参数错误

**错误信息**：`缺少参数: xxx` 或 `未找到枚举值: xxx`

**解决**：
1. 检查函数调用是否提供了所有必需参数
2. 检查枚举值是否拼写正确
3. 确保枚举已定义

### Q5: 如何查看测试日志

1. 点击状态栏的测试结果
2. 或者：查看 → 输出 → 选择 "Tester"

## 下一步

- 阅读 [位域函数语法文档](../BITFIELD_SYNTAX.md) 了解高级功能
- 查看 [examples/vehicle_control.tester](../examples/vehicle_control.tester) 学习实际案例
- 阅读 [Tester语言规范](./Tester语言规范文档.md) 了解完整语法

## 获取帮助

- GitHub Issues: https://github.com/Linhanmic/Tester/issues
- GitHub Discussions: https://github.com/Linhanmic/Tester/discussions
