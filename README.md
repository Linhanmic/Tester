# Tester

为 Tester 语言提供完整的 VS Code 支持。Tester 是一种专门用于汽车 CAN/CAN-FD 总线测试的领域特定语言(DSL)。

## 目录

- [功能特性](#功能特性)
- [快速开始](#快速开始)
- [核心功能](#核心功能)
- [位域函数语法](#位域函数语法)
- [使用示例](#使用示例)
- [文档](#文档)
- [反馈和贡献](#反馈和贡献)

## 功能特性

### 🎨 语法高亮

- 关键字高亮（`tset`, `ttitle`, `tstart`, `tenum`, `tbitfield`等）
- 命令高亮（`tcans`, `tcanr`, `tdelay`, `tconfirm`）
- 数值和十六进制高亮
- 注释支持（行注释 `//` 和块注释 `/* */`）

### 📝 智能编辑

- **代码片段**：快速插入常用代码模板
  - 配置块模板 (`tset`)
  - 测试用例集模板 (`ttitle`)
  - 测试用例模板 (`tstart`)
  - 常用命令片段 (`tcans`, `tcanr`, `tdelay`)
  - 位域函数模板 (`tbitfield`)
- **代码折叠**：测试用例集和测试用例自动折叠
- **大纲视图**：快速导航到测试用例集和测试用例
- **悬停提示**：显示命令和关键字的说明
- **代码透镜**：在编辑器中直接运行测试用例

### 🚀 测试执行

- **一键运行**：直接在编辑器中运行测试
  - 运行全部测试
  - 运行单个测试用例集
  - 运行单个测试用例
- **实时输出**：测试执行结果实时显示
- **状态栏**：显示测试执行进度和结果
- **暂停/继续**：支持测试执行的暂停和继续
- **设备管理**：设备打开、关闭和状态监控

### 📡 CAN通信

- **CAN/CAN-FD支持**：支持标准CAN和CAN-FD通信
- **多通道**：支持多个CAN通道同时工作
- **报文监控**：实时监控收发的CAN报文
- **手动发送**：支持手动发送CAN报文进行调试
- **设备配置**：保存和管理常用的设备配置

### 🔧 位域函数语法

- **枚举定义**：定义可重用的枚举类型
- **位域函数**：将CAN信号位封装为函数
- **多报文支持**：一个函数可以发送多个CAN报文
- **自动编码**：自动处理位域编码和缩放因子
- **脚本转换**：将位域函数语法转换为原始tcans指令

### 🛠️ 开发工具

- **格式化**：自动格式化测试脚本
- **错误检查**：实时语法和语义检查
- **侧边栏视图**：设备状态、报文监控、手动发送

## 快速开始

### 安装

1. 在 VS Code 中打开扩展市场
2. 搜索 "Tester"
3. 点击安装

### 创建第一个测试脚本

1. 创建一个新文件，保存为 `.tester` 扩展名
2. 输入 `ttemplate` 并按 Tab 键，自动生成测试模板
3. 修改配置和测试用例
4. 点击测试用例上方的 "▶ 运行测试" 按钮执行测试

### 基本语法示例

```tester
// 设备配置
tset
  tcaninit 4, 0, 0, 500
tend

// 测试用例集
ttitle=基础CAN测试

  1 tstart=发送测试报文
    // 发送CAN报文: ID=0x100, 数据=01 02 03 04 05 06 07 08
    tcans 0x100, 01 02 03 04 05 06 07 08, 0, 1

    // 等待100ms
    tdelay 100

    // 验证接收: ID=0x200
    tcanr 0x200, 1.0-1.7, print, 1000
  tend

ttitle-end
```

## 核心功能

### CAN报文发送 (tcans)

发送CAN报文，支持单次发送和周期发送：

```tester
// 单次发送
tcans 0x100, 01 02 03 04 05 06 07 08, 0, 1

// 周期发送: 每100ms发送一次，共发送10次
tcans 0x100, 01 02 03 04 05 06 07 08, 100, 10

// 指定通道: 通道1
tcans 1, 0x100, 01 02 03 04 05 06 07 08, 0, 1
```

### CAN报文接收验证 (tcanr)

接收并验证CAN报文的位域值：

```tester
// 验证报文ID=0x200的字节1位0-7的值是否为0x12
tcanr 0x200, 1.0-1.7, 0x12, 1000

// 打印接收到的值
tcanr 0x200, 1.0-1.7, print, 1000

// 验证多个位域
tcanr 0x200, 1.0-1.7+2.0-2.7, 0x12+0x34, 1000
```

### 延时 (tdelay)

在测试中插入延时：

```tester
// 延时100毫秒
tdelay 100

// 延时1秒
tdelay 1000
```

### 用户确认 (tconfirm)

要求用户手动确认某个操作或状态：

```tester
tconfirm 请确认车速显示为100km/h
```

## 位域函数语法

位域函数语法允许您将CAN信号位封装为可重用的函数，极大提升代码可读性和可维护性。

### 定义枚举

```tester
tenum 车速单位 0=km/h, 1=mph, 2=m/s
tenum 档位 0=P档, 1=R档, 2=N档, 3=D档, 4=S档
```

### 定义位域函数（单CAN报文）

```tester
// 参数：车速值（缩放100倍），车速单位
// CAN ID: 0x144
// 位域: 字节1.0-2.7存储车速值，字节3.0-3.1存储单位
tbitfield 车速信号 车速值="车速", 车速单位="单位":
  144, 1.0-2.7="车速"/100, 3.0-3.1="单位"
```

### 定义位域函数（多CAN报文）

```tester
// 一个函数同时发送车速和档位两个CAN报文
tbitfield 车辆状态 车速="车速", 车速单位="单位", 档位="档位":
  144, 1.0-2.7="车速"/100, 3.0-3.1="单位";
  260, 1.0-1.2="档位"
```

### 调用位域函数

```tester
// 发送车速100km/h
车速信号 车速值=100, 车速单位=km/h

// 同时发送车速和档位
车辆状态 车速=100, 车速单位=km/h, 档位=D档
```

### 脚本转换

位域函数语法可以转换为原始的tcans指令，用于调试或兼容旧版本：

1. 打开命令面板 (Ctrl+Shift+P / Cmd+Shift+P)
2. 输入 "Tester: 转换为原始指令脚本"
3. 转换后的脚本将在新窗口中显示

详细说明请参考 [位域函数语法文档](./BITFIELD_SYNTAX.md)

## 使用示例

### 完整测试示例

查看 `examples/vehicle_control.tester` 文件，包含车辆控制系统的完整测试示例，演示了：

- 枚举定义
- 位域函数定义
- 多种测试场景
- 综合测试流程

### 基础示例

查看 `bitfield_example.tester` 文件，演示了位域函数语法的基本用法。

## 文档

### 入门指南
- [快速入门](./docs/QUICK_START.md) - 零基础快速上手指南
- [Tester语言规范](./docs/Tester语言规范文档.md) - 完整的语言规范

### 功能文档
- [位域函数语法](./BITFIELD_SYNTAX.md) - 详细的位域函数语法说明
- [位域函数 vs 传统命令](./docs/BITFIELD_VS_TRADITIONAL.md) - 对比和选择建议
- [TCONFIRM使用说明](./docs/TCONFIRM_USAGE.md) - 用户确认命令说明

### 版本信息
- [更新日志](./CHANGELOG.md) - 版本更新记录
- [v0.0.5 发布说明](./RELEASE_LOG_v0.0.5.md) - 最新版本特性

## 系统要求

- Visual Studio Code 1.80.0 或更高版本
- Windows 操作系统（用于ZLGCAN设备驱动）
- ZLGCAN CAN/CAN-FD 设备

## 反馈和贡献

- 问题反馈: [GitHub Issues](https://github.com/Linhanmic/Tester/issues)
- 功能建议: [GitHub Discussions](https://github.com/Linhanmic/Tester/discussions)

## 许可证

MIT License

Copyright (c) 2025 Linhanmic

## 致谢

感谢 Tester 语言规范的制定者和所有贡献者。
